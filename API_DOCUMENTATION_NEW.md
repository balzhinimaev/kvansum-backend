# Kvansum Backend API Documentation (Updated)

## –û–±–∑–æ—Ä

Backend API –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫ Kvansum —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å–∏—Å—Ç–µ–º—ã —É—Ä–æ–≤–Ω–µ–π –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏.

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **NestJS** - Framework
- **MongoDB + Mongoose** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Socket.IO** - Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **class-validator** - –í–∞–ª–∏–¥–∞—Ü–∏—è DTO
- **TypeScript** - –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
NODE_ENV=development
PORT=3001
MONGODB_URI=mongodb://localhost:27017/kvansum
CORS_ORIGINS=http://localhost:3000,http://localhost:5173
```

### 3. –ó–∞–ø—É—Å–∫ MongoDB

```bash
# –° –ø–æ–º–æ—â—å—é Docker
docker-compose up -d

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
mongod
```

### 4. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã–º–∏ (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

```bash
npm run seed:new
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç:
- 1 —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (ID: `test-user-1`)
- 7 —É—Ä–æ–≤–Ω–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏ (lvl1 - lvl7)
- 23 –ø—Ä–∏–≤—ã—á–∫–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å—Ç—Ä–∏–∫–∞–º–∏
- 10 –º—ã—Å–ª–µ–π –¥–Ω—è
- 3 –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞

### 5. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ü—Ä–æ–¥–∞–∫—à–Ω
npm run build
npm start
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:3001`

---

## API Endpoints

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram Web App –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ `initData`.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
1. –ü–æ–ª—É—á–∏—Ç–µ bot token –æ—Ç [@BotFather](https://t.me/botfather)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ `.env`
3. –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `AUTH_SETUP.md`

#### POST /api/auth/telegram

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Web App (—Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ).

**Request:**
```json
{
  "initData": "query_id=...&user=%7B%22id%22%3A123456789...&hash=..."
}
```

**Response:**
```json
{
  "userId": "507f1f77bcf86cd799439011",
  "telegramId": 123456789,
  "firstName": "John",
  "lastName": "Doe",
  "username": "johndoe",
  "photoUrl": "https://..."
}
```

#### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–æ–º–µ `/health` –∏ `/api/auth/telegram`) —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```http
X-Telegram-Init-Data: query_id=...&user=...&hash=...
```

**–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
–í —Ä–µ–∂–∏–º–µ `NODE_ENV=development` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:

```http
X-User-Id: test-user-1
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- HMAC-SHA256 –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è initData: 24 —á–∞—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—Ä —Å axios:**
```typescript
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:3001',
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ initData –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏
api.interceptors.request.use((config) => {
  const initData = window.Telegram?.WebApp?.initData;
  if (initData) {
    config.headers['X-Telegram-Init-Data'] = initData;
  }
  return config;
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const habits = await api.get('/api/habits');
```

---

## üìã HABITS MODULE

### GET /api/habits
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:**
```json
{
  "habits": [
    {
      "id": "...",
      "levelId": "lvl1",
      "title": "–°—Ç–∞–∫–∞–Ω –≤–æ–¥—ã –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è",
      "emoji": "üíß",
      "imageUrl": null,
      "summary": "–ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ—Å–Ω—É—Ç—å—Å—è",
      "note": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
      "difficulty": "easy",
      "timeOfDay": "morning",
      "days": ["daily"],
      "stages": [
        {
          "days": 7,
          "title": "–ü–µ—Ä–≤—ã–µ —Ä–æ—Å—Ç–∫–∏",
          "description": "–ù–µ–¥–µ–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã"
        },
        {
          "days": 21,
          "title": "–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–π",
          "description": "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏"
        }
      ],
      "streak": 18,
      "bestStreak": 25,
      "totalDone": 45,
      "order": 0,
      "isActive": true,
      "createdAt": "2025-10-29T00:00:00.000Z",
      "time": "07:00",
      "period": "–£—Ç—Ä–æ"
    }
  ]
}
```

**–ù–æ–≤—ã–µ –ø–æ–ª—è:**
- `levelId` - ID —É—Ä–æ–≤–Ω—è (lvl1, lvl2, ..., lvl7)
- `title` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ (–≤–º–µ—Å—Ç–æ name)
- `summary` - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
- `difficulty` - —Å–ª–æ–∂–Ω–æ—Å—Ç—å: "easy" | "medium" | "hard"
- `timeOfDay` - –≤—Ä–µ–º—è –¥–Ω—è: "morning" | "day" | "evening" | "summary"
- `days` - –º–∞—Å—Å–∏–≤ –¥–Ω–µ–π: ["daily"] –∏–ª–∏ ["mon", "wed", "fri"]
- `stages` - —ç—Ç–∞–ø—ã —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–∏–≤—ã—á–∫–∏ (–∫–∞–∂–¥—ã–π —Å days, title, description)

### POST /api/habits
–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø—Ä–∏–≤—ã—á–∫—É

**Request Body:**
```json
{
  "title": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è",
  "levelId": "lvl2",
  "emoji": "üßò",
  "summary": "10 –º–∏–Ω—É—Ç —É—Ç—Ä–µ–Ω–Ω–µ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏",
  "difficulty": "easy",
  "timeOfDay": "morning",
  "days": ["daily"],
  "stages": [
    {
      "days": 7,
      "title": "–ü–µ—Ä–≤—ã–µ —Ä–æ—Å—Ç–∫–∏",
      "description": "–ù–µ–¥–µ–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã"
    },
    {
      "days": 21,
      "title": "–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–π",
      "description": "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤–æ–π –ø—Ä–∏–≤—ã—á–∫–∏"
    }
  ]
}
```

**Validation:**
- `title` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, –º–∞–∫—Å 100 —Å–∏–º–≤–æ–ª–æ–≤
- `levelId` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, ID —É—Ä–æ–≤–Ω—è
- `difficulty` - enum: "easy" | "medium" | "hard"
- `timeOfDay` - enum: "morning" | "day" | "evening" | "summary"
- `days` - –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä ["daily"] –∏–ª–∏ ["mon", "wed", "fri"]

### PATCH /api/habits/:id
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É (—á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)

### DELETE /api/habits/:id
–£–¥–∞–ª–∏—Ç—å (–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å) –ø—Ä–∏–≤—ã—á–∫—É

### POST /api/habits/:id/log
–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏

**Request Body:**
```json
{
  "date": "2025-10-29",
  "status": "success",
  "note": "–û—Ç–ª–∏—á–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞!"
}
```

### GET /api/habits/:id/logs
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–∫–∏

---

## üéØ LEVELS MODULE (NEW)

### GET /api/levels
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É—Ä–æ–≤–Ω–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–∏

**Response:**
```json
{
  "levels": [
    {
      "id": "lvl1",
      "order": 1,
      "title": "–≠–Ω–µ—Ä–≥–∏—è –∏ –±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã",
      "description": "–ü—Ä–∏–≤—ã—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ä—è–∂–∞—é—Ç —Ç–µ–ª–æ –∏ —Å–æ–∑–¥–∞—é—Ç –æ—Å–Ω–æ–≤—É –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–Ω—è",
      "emoji": "ü©µ",
      "nextLevelId": "lvl2"
    },
    {
      "id": "lvl2",
      "order": 2,
      "title": "–§–æ–∫—É—Å –∏ –≤–Ω–∏–º–∞–Ω–∏–µ",
      "description": "–°–æ–±–∏—Ä–∞–µ–º –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º –¥–µ–Ω—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ.",
      "emoji": "üß†",
      "nextLevelId": "lvl3",
      "unlockAfterDays": 21
    }
  ]
}
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Ä–æ–≤–Ω–µ–π:**
1. **lvl1** ü©µ - –≠–Ω–µ—Ä–≥–∏—è –∏ –±–∞–∑–æ–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã
2. **lvl2** üß† - –§–æ–∫—É—Å –∏ –≤–Ω–∏–º–∞–Ω–∏–µ
3. **lvl3** üî• - –°–∏–ª–∞ –≤–æ–ª–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞
4. **lvl4** üåø - –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
5. **lvl5** ‚öôÔ∏è - –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
6. **lvl6** üöÄ - –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ —Ä–æ—Å—Ç
7. **lvl7** üß© - –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä –∂–∏–∑–Ω–∏

---

## üìä PROGRESS MODULE (NEW)

### GET /api/progress
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Response:**
```json
{
  "completionByDate": {
    "2025-10-29": {
      "h-water": "success",
      "h-bed": "success",
      "h-stretch": "fail"
    }
  },
  "habitStreak": {
    "h-water": 18,
    "h-bed": 12,
    "h-stretch": 9,
    "h-cold": 4
  },
  "levelUnlockedAt": {
    "lvl1": "2025-09-01",
    "lvl2": undefined,
    "lvl3": undefined
  }
}
```

**–ü–æ–ª—è:**
- `completionByDate` - —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫ –ø–æ –¥–∞—Ç–∞–º
- `habitStreak` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –¥–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏–≤—ã—á–∫–∏
- `levelUnlockedAt` - –¥–∞—Ç—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É—Ä–æ–≤–Ω–µ–π (undefined = –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)

---

## üìä STATS MODULE

### GET /api/stats/dashboard
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–µ–≥–æ–¥–Ω—è + 7 –¥–Ω–µ–π)

**Response:**
```json
{
  "today": {
    "date": "2025-10-29",
    "total": 3,
    "completed": 2,
    "pending": 1,
    "percent": 67
  },
  "last7Days": [
    {
      "date": "2025-10-23",
      "total": 3,
      "completed": 2,
      "percent": 67
    }
  ],
  "userStats": {
    "totalPoints": 450,
    "currentLevel": 5,
    "currentRank": "active",
    "currentStreak": 7,
    "longestStreak": 12
  }
}
```

### GET /api/stats/weekly
–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é

### GET /api/stats/rank
–ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–Ω–≥–∞ –∏ —É—Ä–æ–≤–Ω—è

---

## üë§ USERS MODULE

### GET /api/users/me
–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### PATCH /api/users/me
–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

### POST /api/users/export
–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (GDPR)

---

## üí≠ THOUGHTS MODULE

### GET /api/thoughts/today
–ú—ã—Å–ª—å –¥–Ω—è (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ –¥–∞—Ç–µ)

### GET /api/thoughts
–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º—ã—Å–ª–µ–π (admin)

### POST /api/thoughts
–°–æ–∑–¥–∞—Ç—å –º—ã—Å–ª—å (admin)

---

## üé® ARTEFACTS MODULE

### GET /api/artefacts
–°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

**Response:**
```json
{
  "artefacts": [
    {
      "id": "art-water-7",
      "title": "–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –ø–∏—Ç—å –≤–æ–¥—É —É—Ç—Ä–æ–º",
      "body": "–ì–∏–¥—Ä–∞—Ç–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ –¥–µ–ª–∞–µ—Ç –º–æ–∑–≥ —è—Å–Ω–µ–µ –±–µ–∑ –∫–æ—Ñ–µ–∏–Ω–∞.",
      "unlock": {
        "type": "habit_stage",
        "habitId": "h-water",
        "days": 7
      }
    },
    {
      "id": "art-level1",
      "title": "–ì–æ—Ç–æ–≤ –∫ ¬´–§–æ–∫—É—Å—É –∏ –≤–Ω–∏–º–∞–Ω–∏—é¬ª",
      "body": "–¢—ã –≤—ã—Å—Ç—Ä–æ–∏–ª —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —ç–Ω–µ—Ä–≥–∏–∏ ‚Äî —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –≤–Ω–∏–º–∞–Ω–∏–µ–º –∏ –∑–∞–¥–∞—á–∞–º–∏.",
      "unlock": {
        "type": "level_progress",
        "levelId": "lvl1",
        "threshold": 0.3
      }
    }
  ]
}
```

**–¢–∏–ø—ã unlock:**
- `habit_stage` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π –ø—Ä–∏–≤—ã—á–∫–∏
- `level_progress` - —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ (threshold - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç 0 –¥–æ 1)

### POST /api/artefacts
–°–æ–∑–¥–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç (admin)

**Request Body:**
```json
{
  "id": "art-custom-1",
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞",
  "body": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞",
  "unlock": {
    "type": "habit_stage",
    "habitId": "h-water",
    "days": 21
  }
}
```

---

## üîå WEBSOCKET EVENTS

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `ws://localhost:3001`

### –°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:

**habit:created**, **habit:updated**, **habit:completed**, **habit:deleted**

---

## üóÑÔ∏è MongoDB –°—Ö–µ–º—ã

### Level (NEW)
```typescript
{
  id: string;              // 'lvl1', 'lvl2', etc.
  order: number;           // –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä
  title: string;           // –ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
  description: string;     // –û–ø–∏—Å–∞–Ω–∏–µ
  emoji: string;           // Emoji —É—Ä–æ–≤–Ω—è
  nextLevelId?: string;    // ID —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
  unlockAfterDays?: number;// –î–Ω–µ–π –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —É—Ä–æ–≤–Ω—è)
}
```

### Habit (UPDATED)
```typescript
{
  _id: string;
  userId: ObjectId;
  levelId: string;              // NEW: ID —É—Ä–æ–≤–Ω—è
  title: string;                // NEW: –±—ã–ª–æ name
  emoji?: string;
  imageUrl?: string;
  summary?: string;             // NEW: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
  note?: string;                // –ó–∞–º–µ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  difficulty?: string;          // NEW: 'easy' | 'medium' | 'hard'
  timeOfDay?: string;           // NEW: 'morning' | 'day' | 'evening' | 'summary'
  days: string[];               // NEW: ['daily'] –∏–ª–∏ ['mon', 'wed']
  stages: Array<{               // NEW: —ç—Ç–∞–ø—ã –ø—Ä–∏–≤—ã—á–∫–∏
    days: number;
    title: string;
    description: string;
  }>;
  streak: number;
  bestStreak: number;
  totalDone: number;
  order: number;
  isActive: boolean;
  isArchived: boolean;
  // –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  time?: string;
  period?: string;
  createdAt: Date;
  updatedAt: Date;
}
```

### UserProgress (NEW)
```typescript
{
  _id: string;
  userId: ObjectId;
  completionByDate: Map<string, Record<string, string>>;  // –î–∞—Ç–∞ -> {habitId: status}
  habitStreak: Map<string, number>;                        // habitId -> streak
  levelUnlockedAt: Map<string, string | undefined>;       // levelId -> –¥–∞—Ç–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
}
```

### Artefact (UPDATED)
```typescript
{
  _id: string;
  id: string;              // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
  title: string;           // –ù–∞–∑–≤–∞–Ω–∏–µ
  body: string;            // –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ/–∫–æ–Ω—Ç–µ–Ω—Ç
  unlock: {                // –£—Å–ª–æ–≤–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    type: 'habit_stage' | 'level_progress';
    // –î–ª—è habit_stage:
    habitId?: string;
    days?: number;
    // –î–ª—è level_progress:
    levelId?: string;
    threshold?: number;    // 0.0 - 1.0
  };
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### –° –ø–æ–º–æ—â—å—é curl

```bash
# Health check
curl http://localhost:3001/health

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏
curl http://localhost:3001/api/habits

# –ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–≤–Ω–∏
curl http://localhost:3001/api/levels

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
curl http://localhost:3001/api/progress

# –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É
curl -X POST http://localhost:3001/api/habits \
  -H "Content-Type: application/json" \
  -d '{
    "title": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è",
    "levelId": "lvl2",
    "emoji": "üßò",
    "summary": "10 –º–∏–Ω—É—Ç —É—Ç—Ä–µ–Ω–Ω–µ–π –º–µ–¥–∏—Ç–∞—Ü–∏–∏",
    "difficulty": "easy",
    "timeOfDay": "morning",
    "days": ["daily"]
  }'
```

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. **Habits:**
   - `name` ‚Üí `title`
   - `note` ‚Üí `summary` (–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã: `levelId`, `days`, `stages`, `timeOfDay`
   - `difficulty`: "–õ–µ–≥–∫–∞—è"/"–°—Ä–µ–¥–Ω—è—è"/"–°–ª–æ–∂–Ω–∞—è" ‚Üí "easy"/"medium"/"hard"
   - `period`: "–£—Ç—Ä–æ"/"–î–µ–Ω—å"/"–í–µ—á–µ—Ä" ‚Üí `timeOfDay`: "morning"/"day"/"evening"/"summary"

2. **–ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏:**
   - `LevelsModule` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏
   - `ProgressController` - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. **–ù–æ–≤—ã–µ endpoints:**
   - `GET /api/levels` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É—Ä–æ–≤–Ω–∏
   - `GET /api/progress` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°—Ç–∞—Ä—ã–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
- `time` (–≤–º–µ—Å—Ç–æ timeOfDay —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º)
- `period` (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–∏–æ–¥–∞ –¥–Ω—è)
- `name` (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ `title` –≤ —Å—Ç–∞—Ä—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö)

---

## üìù Seed –¥–∞–Ω–Ω—ã–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ `npm run seed:new` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:

### 23 –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ 7 —É—Ä–æ–≤–Ω—è–º:

**–£—Ä–æ–≤–µ–Ω—å 1 (ü©µ –≠–Ω–µ—Ä–≥–∏—è):**
- üíß –°—Ç–∞–∫–∞–Ω –≤–æ–¥—ã –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è
- üõèÔ∏è –ó–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç–µ–ª—å
- üßò –†–∞–∑–º–∏–Ω–∫–∞ 5-10 –º–∏–Ω—É—Ç
- ‚ùÑÔ∏è –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π –¥—É—à

**–£—Ä–æ–≤–µ–Ω—å 2 (üß† –§–æ–∫—É—Å):**
- üßò‚Äç‚ôÇÔ∏è –ú–µ–¥–∏—Ç–∞—Ü–∏—è 10 –º–∏–Ω—É—Ç
- üìµ –ù–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω 1 —á–∞—Å
- üéØ –ì–ª—É–±–æ–∫–∞—è —Ä–∞–±–æ—Ç–∞ 90 –º–∏–Ω—É—Ç
- üìö –ß—Ç–µ–Ω–∏–µ 20 —Å—Ç—Ä–∞–Ω–∏—Ü

**–£—Ä–æ–≤–µ–Ω—å 3 (üî• –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞):**
- üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 30 –º–∏–Ω—É—Ç
- üö´ –î–µ–Ω—å –±–µ–∑ —Å–∞—Ö–∞—Ä–∞
- üìù –ü–ª–∞–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞ –≤–µ—á–µ—Ä–æ–º

**–£—Ä–æ–≤–µ–Ω—å 4 (üåø –≠–º–æ—Ü–∏–∏):**
- üôè 3 –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
- üìî –î–Ω–µ–≤–Ω–∏–∫ —ç–º–æ—Ü–∏–π
- üíù –î–æ–±—Ä–æ–µ –¥–µ–ª–æ

**–£—Ä–æ–≤–µ–Ω—å 5 (‚öôÔ∏è –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å):**
- üéØ Most Important Task —Å —É—Ç—Ä–∞
- üì• Inbox Zero –≤–µ—á–µ—Ä–æ–º
- üìä –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ–±–∑–æ—Ä

**–£—Ä–æ–≤–µ–Ω—å 6 (üöÄ –†–æ—Å—Ç):**
- üéì –û–±—É—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç
- üé® –¢–≤–æ—Ä—á–µ—Å–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
- üí° 10 –∏–¥–µ–π –≤ –¥–µ–Ω—å

**–£—Ä–æ–≤–µ–Ω—å 7 (üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä):**
- ‚öôÔ∏è –£–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- ü§î –ì–ª—É–±–æ–∫–∞—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è
- üåü –†–∞–±–æ—Ç–∞ —Å –≤–∏–¥–µ–Ω–∏–µ–º

---

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö:

```typescript
// 3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
const habits = await fetch('/api/habits').then(r => r.json());
const levels = await fetch('/api/levels').then(r => r.json());
const progress = await fetch('/api/progress').then(r => r.json());

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ
<DashboardClient 
  habits={habits}
  levels={levels}
  progress={progress}
/>
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞: `docs/docs-from-frontend/`
- –°—Ç–∞—Ä–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `API_DOCUMENTATION.md`
- Changelog: `CHANGELOG.md`

---

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 1 –Ω–æ—è–±—Ä—è 2025

